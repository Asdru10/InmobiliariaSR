<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mis Propiedades</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/2.0.7/css/dataTables.bootstrap5.min.css" rel="stylesheet" />

    <!-- Iconos Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
</head>
<body class="bg-light p-4">

    <div class="container bg-white p-4 rounded shadow">
        <div class="d-flex justify-content-end mb-3">
            <a asp-area="Cliente" asp-controller="Propiedades" asp-action="Upsert" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> Agregar Propiedad
            </a>
        </div>

        <div class="table-responsive">
            <table id="taskTable" class="table table-bordered table-hover">
                <thead class="table-success text-dark">
                    <tr>
                        <th>ID</th>
                        <th>Descripción</th>
                        <th>Precio</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- DataTables llenará los datos -->
                </tbody>
            </table>
        </div>

        <div class="d-flex justify-content-end mt-3">
            <a asp-controller="Propiedades" asp-action="Index" class="btn btn-outline-secondary w-auto">
                Volver
            </a>
        </div>
    </div>

    <!-- JS de jQuery y Bootstrap y DataTables -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.bootstrap5.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#taskTable').DataTable({
                ajax: {
                    url: '/Cliente/Propiedades/GetAll', // Ajusta esta URL a tu endpoint real que devuelve JSON
                    dataSrc: ''
                },
                columns: [
                    { data: 'id' },
                    { data: 'titulo' },
                    {
                        data: 'precio',
                        render: function(data) {
                            return '₡' + data.toLocaleString('es-CR');
                        }
                    },
                    {
                        data: 'id',
                        render: function (data) {
                            return `
                                <a href="/Cliente/Propiedades/Details/${data}" class="btn btn-primary btn-sm me-1" title="Detalles">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a href="/Cliente/Propiedades/Upsert/${data}" class="btn btn-info btn-sm me-1" title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <button onclick="Delete(${data})" class="btn btn-danger btn-sm" title="Eliminar">
                                    <i class="bi bi-trash"></i>
                                </button>
                            `;
                        },
                        orderable: false,
                        searchable: false
                    }
                ],
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                }
            });
        });

        function Delete(id) {
            Swal.fire({
                title: "¿Estás seguro?",
                text: "¡No podrás revertir esto!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Sí, eliminar",
                cancelButtonText: "Cancelar"
            }).then(result => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: `/Cliente/Propiedades/Delete/${id}`,
                        type: 'DELETE',
                        success: () => {
                            toastr.success("Propiedad eliminada correctamente.");
                            $('#taskTable').DataTable().ajax.reload(null, false);
                        },
                        error: () => toastr.error("Error al eliminar la propiedad.")
                    });
                }
            });
        }
    </script>

    <!-- SweetAlert2 y Toastr (opcional, si quieres usar alertas) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

</body>
</html>

